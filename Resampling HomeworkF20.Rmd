
---
title: "DA2 Resampling Homework"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Data
Premiums3.csv summarizes the an insurance company website showing customer data and whether or not they purchased a policy. The following dimensions are provided:

* Premium *(Quoted Premium by Site)*
* Size *(Home Size)*
* Home.Value *(Home Value)*
* Credit  *(Credit Rating)*
* Exterior *(Home Exterior)*
* Auto  *(Auto Policy with Company)*
* Tier  *(Projected Customer Tier)*
* Purchased *(Policy was Purchased)*

A visualization of Home.Value, Tier, Premium quoted, and Purchase outcome is shown below:
```{r, message=F, warning=F, fig.width=6, fig.height=3, fig.align="center"}

library(tidyverse)
library(caret)
library(MLmetrics)
library(klaR)
library(ISLR)
library(psych)
library(e1071)
library(randomForest)
library(lubridate)
library(stringr)

Premiums = read_csv("C:/Users/ellen/Documents/UH/Fall 2020/Github Staging/EllenwTerry/Foundations/Premiums3.csv")

p = ggplot(Premiums, aes(x = Home.Value, y = Premium, color = Purchased)) +
  geom_point() + 
  facet_wrap(~Tier)
p

```
```{r, message=F, warning=F, fig.width=4, fig.height=3, fig.align="center"}

Premiums$Purchased = factor(Premiums$Purchased)
Premiums$Credit = factor(Premiums$Credit)
Premiums$Exterior = factor(Premiums$Exterior)
Premiums$Credit = factor(Premiums$Credit)
Premiums$Auto = factor(Premiums$Auto)
Premiums$Tier = factor(Premiums$Tier)

Premiums = Premiums %>% rownames_to_column("SampleID")
xTrain <- sample_n(Premiums, round(nrow(Premiums)*.6))
xTest <- Premiums %>% anti_join(xTrain, by = "SampleID")

control <- trainControl(method="repeatedcv", number = 5, repeats = 5) 
metric = "Accuracy"

results <- matrix(ncol = 2, nrow=3)
results[1,1] <- 'glm'
results[2,1] <- 'lda'
results[3,1] <- 'rf'

i <- 3
for(i in 1:nrow(results)){
  caretMod <- train(Purchased ~ Premium + Size + Home.Value + Credit + Exterior + Auto + Tier, 
                    data = Premiums,  
                    trControl=control,
                    metric = metric,
                    method=results[i,1])
  CM = confusionMatrix(predict(caretMod, newdata = xTest), xTest$Purchased, positive = 'Yes')
  results[i,2] = round(as.numeric(CM$byClass[11]),2)
}

#results %>% data.frame() %>% arrange(desc(X2))

```
### Deliverables:
Evaluate *(using Balanced Accuracy)* at least 3 models for predicting Purchase. Show your evaluation and discuss the strengths and weaknesses of each model.


